<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% load static %}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet"
          integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <link rel='stylesheet' href="{% static 'css/index.css' %}">
    <title>{% block title%} {% endblock %}</title>
    <style>
        .dropdown-item:hover {
            background-color: black !important;
            color: blue !important;
            box-shadow: 0px 1px 11px white;
        }

        .dropdown:focus {
            background-color: black !important;
            color: white !important;
        }
    </style>
    {% block css %} {% endblock %}
</head>
<body>
{% load static %}

<nav class="navbar navbar-expand-lg bg-black ">
    <div class="container-fluid">
        <a class="navbar-brand text-white fs-1 fw-bolder title" href="/">MY SHOPPING</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse ms-5" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item ">
                    <a class="nav-link text-white home" aria-current="page" href="/shop/index">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white about" href="/shop/about">About Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white tracker" href="/shop/tracker">Tracker</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white blog" href="/blog">Blog</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white contact" href="/shop/contact">Contact Us</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white history" href="/shop/history">Order History</a>
                </li>
                {%if user.is_authenticated%}
                <li>
                    <div class="dropdown">
                        <button class="btn btn-outline-success " type="button"
                                data-bs-toggle="dropdown"
                                aria-expanded="false">
                            Welcome <span class="ms-1 fw-bolder text-white"> {{request.user}}</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/shop/logout">Logout</a></li>
                        </ul>
                    </div>
                </li>

                {%else%}
                <li class="ms-2">
                    <div class="dropdown">
                        <button class="btn btn-outline-light dropdown" type="button"
                                data-bs-toggle="dropdown"
                                aria-expanded="false">
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                     class="bi bi-person-fill" viewBox="0 0 16 16">
                                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                </svg>
                            </span>
                        </button>

                        <ul class="dropdown-menu bg-black ">
                            <li>
                                <a type="button" class="dropdown-item text-white" href="/shop/">
                                    Login
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>


                {%endif%}
            </ul>
            <div class="row">
                <div class="col cart px-0">
                    <a href="/shop/cart" class="text-decoration-none">
                        <button type="button" class="btn btn-outline-light" id="popcart">
                            Cart(<span id="cart">0</span>)
                        </button>
                    </a>
                    <span class=" remove_cart px-0">
                            <button id="clearcart" class="btn btn-outline-light ms-2" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                     class="bi bi-trash3" viewBox="0 0 16 16">
                                    <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
                                </svg>
                            </button>
                        </span>
                </div>
                <div class="col-auto d-flex">
                    <form method="get" action="/shop/search" class=" mx-4 d-flex" role="search">{% csrf_token %}
                        <input class="form-control me-2 bg-transparent" type="search" placeholder="Search"
                               aria-label="Search"
                               name="queary"
                               id="queary">
                        <button class="btn btn-outline-success me-2" type="submit">Search</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</nav>
{%for message in messages%}
<div>
    <div class="alert alert-{{message.tags}} alert-dismissible fade show" role="alert">
        <strong>Message:</strong>{{message}}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
</div>

{%endfor%}


{% block body%} {% endblock %}
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
        crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="sweetalert2.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>


    if (localStorage.getItem('cart') == null) {
        var cart = {};
    } else {
        cart = JSON.parse(localStorage.getItem('cart'));

        var sum = 0;
        for (item in cart) {
            sum = sum + cart[item].qty;
        }

    }
    $('#clearcart').click(function () {
        cart = JSON.parse(localStorage.getItem('cart'));
        cart = {};
        update_cart(cart);
        delete_data();
        document.location = '/shop/index';
    });

    function update_cart(cart) {
        var sum = 0
        for (var item in cart) {
            sum = sum + cart[item].qty;
        }
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    function delete_data() {
        var formdata = {
            'user_id': localStorage.getItem('id'),
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        };
        $.ajax({
            type: 'POST',
            url: '/shop/cart_delete/',
            data: formdata,
            encode: true,
        })
    }

    $('#logout').click(function () {
        delete_data()
        localStorage.clear()
    })


</script>
{% block js %} {% endblock %}
</body>
</html>

