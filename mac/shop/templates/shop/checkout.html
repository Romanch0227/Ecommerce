{% extends 'shop/basic.html' %}

{% block title%}Checkout{% endblock %}
{% block css %}
<style>

    #clearcart {
        display: none;
    }

    .price {
        text-shadow: 3px 3px red;
    }

    #popcart {
        box-shadow: 0px 0px 25px 3px red !important;
        color: red !important;

    }


</style>

{% endblock %}


{% block body%}
{% load static %}

<div class="container text-white">
    <div class="col my-4">
        <h2 class="mb-4">Step1-My Shopping Cart Checkout-Review your item</h2>
        <ol class="list-group list-group-numbered" id="items">
            {%for i in list%}
            <li class="list-group-item d-flex justify-content-between align-items-start  bg-black text-white">
                <div class="ms-2 me-auto name">{{i.name}}</div>
                <span class="badge bg-primary rounded-pill num_item">{{i.qty}}</span>
            </li>
            {%endfor%}
        </ol>
        <h1 class="text-center price">Total Price: <span id="totalprice">{{total}}</span> Rs</h1>

    </div>
    <div class="col my-4">
        <h2 class="mb-4">Step2-Enter Address & Other Details</h2>
        <form class="row g-3" method="post" action="/shop/checkout/">{% csrf_token %}
            <input type="hidden" id="itemsJson" name="itemsJson">
            <input type="hidden" id="amount" name="amount">
            <div class="col-md-6">
                <label for="name" class="form-label">Name</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="col-md-6">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" pattern="[a-z0-9]+@gmail\.com"
                       required>
            </div>
            <div class="col-12">
                <label for="address1" class="form-label">Address</label>
                <input type="text" class="form-control" id="address1" name="address1" required>
            </div>
            <div class="col-12">
                <label for="address2" class="form-label">Address-Line 2</label>
                <input type="text" class="form-control" id="address2" name="address2">
            </div>
            <div class="col-md-6">
                <label for="city" class="form-label">City</label>
                <input type="text" class="form-control" id="city" name="city" required>
            </div>
            <div class="col-md-4">
                <label for="state" class="form-label">State</label>
                <input type="text" class="form-control" id="state" name="state" required>

            </div>
            <div class="col-md-2">
                <label for="zip" class="form-label">Zip</label>
                <input type="text" class="form-control" id="zip" name="zip_code" required>
            </div>
            <div class="">
                <label for="phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="phone" name="phone" required>
            </div>

            <div class="col-12 text-center py-4">
                <button type="submit" class="btn btn-primary fs-3" id="submit">Place Order...</button>
            </div>

        </form>

    </div>
</div>


{% endblock %}
{% block js %}

<script>
    $('#amount').val($('#totalprice').html())
    $('#itemsJson').val(JSON.stringify(cart));
    {%if thank %}
    Swal.fire({
        icon: 'success',
        title: "Thanks for ordering with us. Your order id is {{id}}. Use it to track your order using our order tracker",
        showConfirmButton: false,
        timer: 5000
    }).then(function () {
        delete_data();
        localStorage.clear();
        document.location = "/shop/tracker";
    })
    {%endif%}

    function delete_data() {
        var formdata = {
            'user_id': localStorage.getItem('id'),
            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()
        };
        $.ajax({
            type: 'POST',
            url: '/shop/cart_delete/',
            data: formdata,
            encode: true,
        })
    }
</script>


{% endblock %}
